library(vcfR)
library(data.table)
library(ggplot2)
install("../cats")
library(devtools)
install("../PolyMorphology/")
document()
install("../PolyMorphology")
library(PolyMorphology)
mappability1<-read_lines("~/Dropbox/Research/Collaborations/Pablo/vitis/data/mapp/mapp100_2.txt", skip=1,n_max=2)
?read_lines
??read_lines
library(readr)
mappability1<-read_lines("~/Dropbox/Research/Collaborations/Pablo/vitis/data/mapp/mapp100_2.txt", skip=1,n_max=2)
mappability1<-mappability1[1]
mappability1<-strsplit(mappability1, split=" ")
mappability1<-unlist(mappability1)
mappability1<-as.numeric(mappability1)
gff="~/Dropbox/Research/Collaborations/Pablo/vitis/data/reference/Vitis_vinifera_gene_Cost3_annotation_on_V2_20.gff3"
if (is.character(gff)){
gff<-fread(gff)
colnames(gff)<-c("chr","source","type","start","stop","V1","direction","V2","info")
}
library(data.table)
if (is.character(gff)){
gff<-fread(gff)
colnames(gff)<-c("chr","source","type","start","stop","V1","direction","V2","info")
}
genes<-gff[type=="gene" & chr %in% 1 & direction=="+"]
mapp<-c()
for(i in -3000:3000){
cat(i, "\n")
mapp<-c(mapp, mean(mappability1[genes$start-i], na.rm=T))
}
plot(mapp, type="l");abline(v=3000)
mapp
genes$start
genes
gff
genes
gff
genes<-gff[type=="gene" & chr %in% "chr00" & direction=="+"]
mapp<-c()
for(i in -3000:3000){
cat(i, "\n")
mapp<-c(mapp, mean(mappability1[genes$start-i], na.rm=T))
}
plot(mapp, type="l");abline(v=3000)
plot(mapp, ylim=c(0,1), type="l", col="green");abline(v=3000, col="gray", lty=3)
tss<-mapp
mapp<-c()
for(i in -3000:3000){
cat(i, "\n")
mapp<-c(mapp, mean(mappability1[genes$stop-i], na.rm=T))
}
plot(mapp, type="l");abline(v=3000)
tts<-mapp
tss_tts_mapp<-data.table(mapp=c(tss, tts), pos=-3000:3000, loc=rep(c("TSS", "TTS"), each=6001))
tss_tts_mapp
plot(mapp, type="l");abline(v=3000)
mapp<-c()
for(i in -3000:3000){
cat(i, "\n")
mapp<-c(mapp, mean(mappability1[genes$start-i], na.rm=T))
}
plot(mapp, type="l");abline(v=3000)
vcfs<-lapply(list.files("~/Dropbox/Research/somatic_mutation/data/rice/wang/",full.names=T) , function(file){
data<-read.vcfR(file)
data<-data.table(data@fix)
data$CHROM<-gsub("NC_029256.1","chr01",data$CHROM)
data<-data[CHROM=="chr01"]
data$UNIQUE<-paste0(data$CHROM, data$POS, data$ALT)
data$FILE<-file
return(data)
})
install("../PolyMorphology")
library(devtools)
install("../PolyMorphology")
out<-"~/desrk"
setwd(out)
out<-"~/Desktop"
setwd(out)
x-
i<-unlist(genes[chr==chrom][1])
document()
library(devtools)
document()
document()
document()
document()
install("../polymorphology")
tss_tts.variants.plot<-function(positions, window=10, color="green4"){
positions$bins<-as.numeric(as.character(cut(positions$pos, breaks=seq(-3000, 3000, by=window), labels=seq(-3000, 3000, by=window)[-1])))
positions_means<-positions[!is.na(bins),.N, by=.(bins, loc)]
plot<-ggplot(positions_means, aes(x=bins, y=N))+
geom_line(aes(group=1), col=color, size=0.25)+
facet_grid(~loc, scales = "free")+
theme_classic(base_size = 6)+
scale_x_continuous(name="Relative genomic positions")+
geom_vline(xintercept=0, linetype="dashed", size=0.25)+
scale_y_continuous(name="Variants")+
theme(strip.background = element_blank(),
strip.text.x = element_blank(),
panel.background = element_rect(colour = "black", size=0.5))
return(plot)
}
tss_tts.variants.plot<-function(positions, window=10, color="green4"){
positions$bins<-as.numeric(as.character(cut(positions$pos, breaks=seq(-3000, 3000, by=window), labels=seq(-3000, 3000, by=window)[-1])))
positions_means<-positions[!is.na(bins),.N, by=.(bins, loc)]
plot<-ggplot(positions_means, aes(x=bins, y=N))+
geom_line(aes(group=1), col=color, size=0.25)+
facet_grid(~loc, scales = "free")+
theme_classic(base_size = 6)+
scale_x_continuous(name="Relative genomic positions")+
geom_vline(xintercept=0, linetype="dashed", size=0.25)+
scale_y_continuous(name="Variants")+
theme(strip.background = element_blank(),
strip.text.x = element_blank(),
panel.background = element_rect(colour = "black", size=0.5),
axis.line.y = element_blank())
return(plot)
}
